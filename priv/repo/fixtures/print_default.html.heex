<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Invoice</title>

    <style type="text/css">
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      html {
        font-size: 16px;
      }

      body {
        margin: 2cm 2cm 0;
        color: #3d3f3e;
      }

      h1 {
        text-transform: uppercase;
        font-weight: normal;
        font-size: 1.2rem;
      }

      .row + h1 {
        margin: -1rem 0 1rem;
      }

      p {
        margin-bottom: .5rem;
      }

      .text-right {
        text-align: right;
      }

      .text-muted {
        color: #6f7371;
      }

      .invoice {
        font-size: 100%;
        font-family: Helvetica, Arial, sans-serif;
        color: #3d3f3e;
      }

      .logo {
        max-height: 50px;
        width: auto;
      }

      .row {
        clear: both;
        margin-bottom: 2rem;
      }
      .row::after {
        content: "";
        display: table;
        clear: both;
      }

      .section, .section-sm, .section-lg {
        min-height: 1px;
        width: 50%;
        float: left;
        list-style: none;
      }

      .section-sm {
        width: 40%;
      }

      .section-lg {
        width: 60%;
      }

      .company {
        list-style: none;
        font-size: 90%;
        line-height: 1.2;
      }
      .company .company__name {
        margin-bottom: .5rem;
      }
      .company .company__name + .company__id {
        margin-top: -.5rem;
        margin-bottom: .5rem;
      }
      .company .company__address {
        margin-bottom: .5rem;
      }

      .customer .company__name {
        font-size: 1.2rem;
      }

      .status {
        color: white;
        float: right;
        border: 1px solid #cbcbc0;
        border-left: none;
        padding: 1.623rem;
        margin-top: -1rem;
      }

      .failed {
        background-color: rgb(55, 58, 60);
      }

      .past_due {
        background-color: #d9534f;
      }

      .draft {
        background-color: #ddd;
      }

      .paid {
        background-color: #5cb85c;
      }

      .pending {
        background-color: #D8B256;
      }

      .amount {
        font-size: 2rem;
        font-weight: bold;
        text-align: center;
        border: 1px solid #cbcbc0;
        padding: 1rem;
        float: right;
        margin-top: -1rem;
      }

      .amount__currency {
        font-size: 1.125rem;
        color: #cbcbc0;
      }

      table {
        border-collapse: collapse;
      }
      table thead th {
        border-bottom: 1px solid #cbcbc0;
        background-color: #e7e7e2;
      }
      table td, table th {
        text-align: left;
        padding: .625rem;
      }
      table .total {
        text-align: right;
        white-space: nowrap;
        width: 10rem;
      }
      table.info {
        float: right;
        font-size: 90%;
        margin-bottom: 1rem;
      }
      table.info td, table.info th {
        padding: .5rem;
      }
      table.info tr:nth-child(even) {
        background-color: #f2f2ef;
      }
      table.items {
        width: 100%;
        margin-bottom: 2rem;
        border: 1px solid #cbcbc0;
      }
      table.items tr:nth-child(even) {
        background-color: #f2f2ef;
      }
      table.totals {
        float: right;
      }
      table.totals td, table.totals th {
        text-align: right;
      }
      table.totals .grand-total {
        font-size: 1.5rem;
        font-weight: bold;
      }

      .notes {
        font-size: 90%;
      }
      .notes .notes__title {
        font-size: 1rem;
        font-weight: bold;
      }

      @media print {
        body {
          margin: 0;
          width: 100%;
        }

        .section, .section-sm, .section-lg {
          page-break-inside: avoid;
        }
      }
    </style>
  </head>
  <body class="invoice">
    <h1>Invoice</h1>
    <br>

    <div class="row">
      <div class="section-sm">
        <p class="text-muted">Billed to:</p>
        <ul class="company customer">
          <%= if @invoice.name do %>}
            <li class="company__name"><%= @invoice.name %></li>
          <% end %>
          <%= if @invoice.identification do %>
            <li class="company__id"><%= @invoice.identification %></li>
          <% end %>
          <%= if @invoice.invoicing_address || @invoice.contact_person do %>
            <li class="company__address">
              <%= if @invoice.contact_person do %>
                <%= @invoice.contact_person %><br>
              <% end %>
              <%= if @invoice.invoicing_address do %>
                <%= @invoice.invoicing_address %>
              <% end %>
            </li>
          <% end %>
          <%= if @invoice.email do %>
            <li><%= @invoice.email %></li>
          <% end %>
        </ul>
      </div>
      <div class="section-lg">
        <table cellspacing="0" class="info">
          <tbody>
            <tr>
              <th>Invoice Number:</th>
              <td class="total"><%= @invoice.name %></td>
            </tr>
            <tr>
              <th>Billed:</th>
              <td class="total"><%= @invoice.issue_date %></td>
            </tr>
            <tr>
              <th>Due on:</th>
              <td class="total"><%= @invoice.due_date %></td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <div class="row">
      <div class={"status #{Invoices.status(@invoice)}"}>
        <%= Invoices.status(@invoice) %>
      </div>
      <div class="amount">
        <%= @invoice.gross_amount %>
        <span class="amount__currency"><%= @invoice.currency %></span>
      </div>
    </div>

    <table class="items" cellspacing="0">
      <thead>
        <tr>
          <th>Description</th>
          <%= if have_items_discount?(@invoice.items) do %>
            <th>Price</th>
            <th>Discount</th>
          <% end %>
          <th class="total">Total</th>
        </tr>
      </thead>
      <tbody>
        <%= for item <- @invoice.items do %>
          <tr>
            <td> <%= item.description %> </td>
            <%= if have_items_discount?([item]) do %>
              <td>
                <%= @invoice.currency %>
                <%= item.unitary_cost %>
              </td>
              <td>
                <%= @invoice.currency %>
                <%= item.discount %>
              </td>
            <% end %>
            <td class="total">
              <%= @invoice.currency %>
              <%= item.net_amount %>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>

    <div class="row">
      <div class="section">
        <%= if @invoice.terms do %>
          <div class="notes">
            <p class="notes__title">Terms &amp; Conditions</p>
            <div class="notes__content">
              <%= @invoice.terms %>
            </div>
          </div>
        <% end %>
      </div>
      <div class="section">
        <table class="totals" cellspacing="0">
          <tbody>
            <tr>
              <th>Subtotal</th>
              <td class="total">
                <%= @invoice.currency %>
                <%= @invoice.net_amount %>
              </td>
            </tr>
            <%# <%= for tax <- @invoice.taxes do  %>
              <tr>
                <th> tax </th>
                <td class="total">
                  <%= @invoice.currency %>
                  tax.value
                </td>
              </tr>
            <%# <% end %>
            <tr class="grand-total">
              <th>Total</th>
              <td class="total">
                <%= @invoice.currency %>
                <%= @invoice.gross_amount %>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </body>
</html>

